<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>enjoy page - Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ì¶”ê°€ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonts-archive/HakgyoansimDunggeunmiso/HakgyoansimDunggeunmiso.css" type="text/css"/>
    
    <style>
        @font-face {
            font-family: 'GmarketSansMedium';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'ROKGSans';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/ROKGSansBold.woff') format('woff');
            font-weight: bold;
            font-style: normal;
        }

        body { 
            font-family: 'GmarketSansMedium', sans-serif;
            background-color: #f8f9fa;
            -webkit-tap-highlight-color: transparent;
        }
        
        .font-logo { font-family: 'Hakgyoansim Dunggeunmiso', sans-serif; }
        .font-gov { 
            font-family: 'ROKGSans', sans-serif;
            text-shadow: 1px 0 0 currentColor, 0 1px 0 currentColor; 
        }

        .btn-hover { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-hover:active { transform: scale(0.96); }

        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .hidden-screen { display: none; }
        .shuffling { color: #005ED2; opacity: 0.7; }

        /* ì•Œë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
        .slide-down { animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(0); } to { transform: translateY(-100%); } }
    </style>
</head>
<body class="h-[100dvh] w-full bg-gray-50 overflow-hidden relative">

    <!-- ==================== ìƒë‹¨ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ ==================== -->
    <div id="notification-container" class="fixed top-0 left-0 w-full z-[100] flex flex-col items-center pointer-events-none">
        <!-- ë™ì ìœ¼ë¡œ ì•Œë¦¼ì´ ì¶”ê°€ë¨ -->
    </div>

    <!-- ==================== ê´€ë¦¬ì ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) ==================== -->
    <!-- ìœ„ì¹˜ë¥¼ í—¤ë” ë¼ì¸ìœ¼ë¡œ ë‚´ë¦¬ì§€ ì•Šê³ , ìš”ì²­ëŒ€ë¡œ ì•„ì´ì½˜ ì •ë ¬ì„ ìœ„í•´ absolute ìœ ì§€í•˜ë˜ ìœ„ì¹˜ ì¡°ì • -->
    <div class="absolute top-6 right-6 z-50">
        <button onclick="openAdminLogin()" class="p-2 bg-white/80 backdrop-blur-sm rounded-full shadow-sm text-gray-400 hover:text-blue-600 transition-colors">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </button>
    </div>

    <!-- ==================== 1. ë©”ì¸ ë©”ë‰´ ==================== -->
    <div id="screen-game-menu" class="h-full w-full flex flex-col items-center justify-start p-6 pt-12 bg-gray-50 overflow-y-auto fade-in">
        <div class="w-full max-w-xs flex flex-col gap-6">
            
            <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” (ë’¤ë¡œê°€ê¸°) -->
            <div class="w-full flex justify-start -mb-4 z-10">
                <button onclick="window.location.href='https://won429.github.io/enjoysite/'" class="p-2 -ml-2 text-gray-400 hover:text-black transition-colors" aria-label="ë©”ì¸ìœ¼ë¡œ">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                </button>
            </div>

            <!-- í—¤ë” -->
            <div class="flex items-center justify-center gap-3 mb-2">
                <img src="./image.png" alt="Logo" class="w-10 h-10 object-contain drop-shadow-sm" onerror="this.style.display='none'"> 
                <h2 class="text-2xl font-bold font-logo text-black tracking-tight pt-1">Random enjoy</h2>
            </div>

            <!-- ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ -->
            <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 mb-2">
                <p class="text-xs text-blue-500 font-bold mb-1">PARTICIPANTS</p>
                <p class="text-sm text-gray-700 leading-relaxed font-medium">
                    ì „ì‹œê¸°, ì˜¤ìŠ¤í‹´, ì§€ë…¸, í™ë°•ì‚¬, ì„±ì›ì œ <br>
                    <span class="text-gray-400 text-xs">(ì´ 5ëª…)</span>
                </p>
            </div>

            <!-- ë©”ë‰´ ë²„íŠ¼ë“¤ -->
            <button id="btn-menu-car" onclick="switchScreen('screen-car-game');" class="btn-hover w-full bg-white p-6 rounded-2xl shadow-sm border border-gray-200 text-left flex flex-col gap-3 group relative overflow-hidden">
                <div class="absolute right-[-20px] top-[-20px] w-24 h-24 bg-blue-100 rounded-full opacity-50 group-hover:scale-110 transition-transform"></div>
                <div class="w-12 h-12 bg-[#005ED2] text-white rounded-xl flex items-center justify-center z-10 shadow-md shadow-blue-200">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>
                </div>
                <div class="z-10">
                    <h3 class="text-lg font-bold mb-1">ì°¨ëŸ‰ & ìš´ì „ì ë½‘ê¸°</h3>
                    <p class="text-xs text-gray-500">ìš´ì „ìì™€ ì¢Œì„ ìœ„ì¹˜ë¥¼ ëœë¤ìœ¼ë¡œ ì •í•©ë‹ˆë‹¤.</p>
                </div>
            </button>

            <button id="btn-menu-chore" onclick="switchScreen('screen-chore-game');" class="btn-hover w-full bg-white p-6 rounded-2xl shadow-sm border border-gray-200 text-left flex flex-col gap-3 group relative overflow-hidden">
                <div class="absolute right-[-20px] top-[-20px] w-24 h-24 bg-green-100 rounded-full opacity-50 group-hover:scale-110 transition-transform"></div>
                <div class="w-12 h-12 bg-green-500 text-white rounded-xl flex items-center justify-center z-10 shadow-md shadow-green-200">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>
                </div>
                <div class="z-10">
                    <h3 class="text-lg font-bold mb-1">ì²­ì†Œ & ì„¤ê±°ì§€ ë‹¹ë²ˆ</h3>
                    <p class="text-xs text-gray-500">ì˜¤ëŠ˜ì˜ ì¼ê¾¼ì„ ê³µì •í•˜ê²Œ ë½‘ì•„ë“œë¦½ë‹ˆë‹¤.</p>
                </div>
            </button>

            <button id="btn-menu-trip" onclick="switchScreen('screen-trip-game');" class="btn-hover w-full bg-white p-6 rounded-2xl shadow-sm border border-gray-200 text-left flex flex-col gap-3 group relative overflow-hidden">
                <div class="absolute right-[-20px] top-[-20px] w-24 h-24 bg-purple-100 rounded-full opacity-50 group-hover:scale-110 transition-transform"></div>
                <div class="w-12 h-12 bg-purple-500 text-white rounded-xl flex items-center justify-center z-10 shadow-md shadow-purple-200">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                </div>
                <div class="z-10">
                    <h3 class="text-lg font-bold mb-1">ì—¬í–‰ì§€ ë½‘ê¸°</h3>
                    <p class="text-xs text-gray-500">ì–´ë””ë¡œ ë– ë‚ ê¹Œìš”? ì „êµ­ 8ë„ ëœë¤ ì¶”ì²œ!</p>
                </div>
            </button>
        </div>
    </div>

    <!-- ==================== 2. ì°¨ëŸ‰ ë°°ì¹˜ í™”ë©´ ==================== -->
    <div id="screen-car-game" class="hidden-screen h-full w-full flex-col items-center justify-start p-6 pt-8 bg-white overflow-y-auto">
        <div class="w-full max-w-xs flex flex-col gap-4">
            <div class="flex items-center justify-between mb-4">
                <button onclick="switchScreen('screen-game-menu')" class="p-2 -ml-2 text-gray-400 hover:text-black"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button>
                <h2 class="text-lg font-bold">ì°¨ëŸ‰ ì¢Œì„ ë°°ì¹˜</h2>
                <div class="w-8"></div>
            </div>

            <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 flex flex-col gap-3">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700">ìš´ì „ì ì„ ì • ë°©ì‹</span>
                    <div class="bg-gray-200 p-1 rounded-lg flex text-xs font-bold">
                        <button id="mode-random" onclick="setDriverMode('random')" class="px-3 py-1.5 rounded-md bg-white text-black shadow-sm transition-all">ëœë¤</button>
                        <button id="mode-manual" onclick="setDriverMode('manual')" class="px-3 py-1.5 rounded-md text-gray-400 transition-all">ìˆ˜ë™</button>
                    </div>
                </div>
                <div id="manual-selector" class="hidden flex-wrap gap-2 pt-2 border-t border-gray-200"></div>
            </div>

            <div class="relative w-full aspect-[3/4] bg-[#f0f4f8] rounded-[2.5rem] border-4 border-gray-100 p-6 flex flex-col justify-between shadow-inner mt-2">
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-3/4 h-8 bg-gradient-to-b from-blue-100/50 to-transparent rounded-b-3xl"></div>
                <div class="flex gap-4 mb-4">
                    <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-[#005ED2] flex flex-col items-center justify-center relative shadow-sm">
                        <span class="absolute top-2 left-2 text-[10px] text-[#005ED2] font-bold bg-blue-50 px-1.5 py-0.5 rounded">DRIVER</span>
                        <div id="seat-driver" class="text-lg font-bold text-black">?</div>
                        <svg class="absolute bottom-2 right-2 text-blue-100 w-8 h-8" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
                    </div>
                    <div class="w-1/2 aspect-square bg-white rounded-2xl border border-gray-200 flex flex-col items-center justify-center relative shadow-sm">
                        <span class="absolute top-2 left-2 text-[10px] text-gray-400">PASSENGER</span>
                        <div id="seat-p1" class="text-lg font-bold text-gray-800">?</div>
                    </div>
                </div>
                <div class="flex gap-2 h-24">
                    <div class="flex-1 bg-white rounded-xl border border-gray-200 flex items-center justify-center shadow-sm"><div id="seat-b1" class="text-sm font-bold text-gray-800">?</div></div>
                    <div class="flex-1 bg-white rounded-xl border border-gray-200 flex items-center justify-center shadow-sm"><div id="seat-b2" class="text-sm font-bold text-gray-800">?</div></div>
                    <div class="flex-1 bg-white rounded-xl border border-gray-200 flex items-center justify-center shadow-sm"><div id="seat-b3" class="text-sm font-bold text-gray-800">?</div></div>
                </div>
                <p class="text-center text-xs text-gray-400 mt-2">BACK SEATS</p>
            </div>

            <button id="btn-run-car" onclick="requestCarGame()" class="w-full bg-[#005ED2] text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 active:scale-95 transition-transform mt-2 text-lg">
                ê²°ê³¼ í™•ì¸í•˜ê¸°
            </button>
        </div>
    </div>

    <!-- ==================== 3. ì²­ì†Œ ê²Œì„ í™”ë©´ ==================== -->
    <div id="screen-chore-game" class="hidden-screen h-full w-full flex-col items-center justify-start p-6 pt-8 bg-white overflow-y-auto">
        <div class="w-full max-w-xs flex flex-col gap-6">
            <div class="flex items-center justify-between mb-2">
                <button onclick="switchScreen('screen-game-menu')" class="p-2 -ml-2 text-gray-400 hover:text-black"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button>
                <h2 class="text-lg font-bold">ë‹¹ë²ˆ ë½‘ê¸°</h2>
                <div class="w-8"></div>
            </div>
            <p class="text-center text-gray-500 text-sm mb-4">ì˜¤ëŠ˜ì˜ í¬ìƒì–‘(?)ì„ ë½‘ì•„ì£¼ì„¸ìš”.</p>

            <div class="w-full bg-blue-50 rounded-2xl p-6 flex items-center justify-between border border-blue-100">
                <div class="flex flex-col gap-1">
                    <div class="flex items-center gap-2 text-blue-600 mb-1">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>
                        <span class="text-xs font-bold uppercase tracking-wider">Cleaning</span>
                    </div>
                    <span class="text-lg font-bold text-gray-900">ì²­ì†Œ ë‹¹ë²ˆ</span>
                </div>
                <div id="result-cleaning" class="h-12 px-6 bg-white rounded-xl flex items-center justify-center font-bold text-xl text-blue-600 shadow-sm min-w-[100px] transition-colors">?</div>
            </div>

            <div class="w-full bg-green-50 rounded-2xl p-6 flex items-center justify-between border border-green-100">
                <div class="flex flex-col gap-1">
                    <div class="flex items-center gap-2 text-green-600 mb-1">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"></path></svg>
                        <span class="text-xs font-bold uppercase tracking-wider">Dishes</span>
                    </div>
                    <span class="text-lg font-bold text-gray-900">ì„¤ê±°ì§€ ë‹¹ë²ˆ</span>
                </div>
                <div id="result-dishes" class="h-12 px-6 bg-white rounded-xl flex items-center justify-center font-bold text-xl text-green-600 shadow-sm min-w-[100px] transition-colors">?</div>
            </div>

            <button id="btn-run-chore" onclick="requestChoreGame()" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg active:scale-95 transition-transform mt-8 text-lg">
                ì¶”ì²¨ ì‹œì‘í•˜ê¸°!
            </button>
        </div>
    </div>

    <!-- ==================== 4. ì—¬í–‰ì§€ ê²Œì„ í™”ë©´ ==================== -->
    <div id="screen-trip-game" class="hidden-screen h-full w-full flex-col items-center justify-start p-6 pt-8 bg-white overflow-y-auto">
        <div class="w-full max-w-xs flex flex-col gap-4">
            <div class="flex items-center justify-between mb-2">
                <button onclick="switchScreen('screen-game-menu')" class="p-2 -ml-2 text-gray-400 hover:text-black"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button>
                <h2 class="text-lg font-bold">ì—¬í–‰ì§€ ë½‘ê¸°</h2>
                <div class="w-8"></div>
            </div>
            <p class="text-center text-gray-500 text-sm mb-4">2ë‹¨ê³„ ëœë¤ ì¶”ì²¨ ì‹œìŠ¤í…œ</p>

            <div class="w-full bg-purple-50 rounded-2xl p-4 border-2 border-purple-100 flex flex-col items-center justify-center relative shadow-sm">
                <div class="flex items-center gap-2 mb-2">
                    <span class="w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-purple-600 text-xs font-bold">1</span>
                    <span class="text-xs font-bold text-purple-500 uppercase tracking-widest">REGION</span>
                </div>
                <div id="result-trip-step1" class="text-2xl font-bold text-gray-900 break-keep text-center min-h-[2rem]">?</div>
            </div>

            <div class="flex justify-center -my-2 z-10">
                <div class="bg-white p-1 rounded-full border border-gray-100 shadow-sm"><svg class="text-gray-300" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/></svg></div>
            </div>

            <div id="box-trip-step2" class="w-full bg-white rounded-2xl p-4 border-2 border-gray-100 flex flex-col items-center justify-center relative shadow-sm transition-colors duration-300">
                <div class="flex items-center gap-2 mb-2">
                    <span class="w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 text-xs font-bold transition-colors" id="badge-step2">2</span>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest transition-colors" id="label-step2">DETAIL</span>
                </div>
                <div id="result-trip-step2" class="text-2xl font-bold text-gray-300 break-keep text-center min-h-[2rem] transition-colors">-</div>
            </div>

            <button id="btn-run-trip" onclick="requestTripGame()" class="w-full bg-purple-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-purple-200 active:scale-95 transition-transform mt-4 text-lg">
                ì—¬í–‰ì§€ í™•ì¸í•˜ê¸°
            </button>
        </div>
    </div>

    <!-- ==================== ê´€ë¦¬ì ëª¨ë‹¬ ==================== -->
    <div id="modal-admin-login" class="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl">
            <h3 class="text-lg font-bold mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
            <input type="password" id="admin-pw" class="w-full border border-gray-300 rounded-lg p-3 mb-4 text-center" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            <div class="flex gap-2">
                <button onclick="closeAdminLogin()" class="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-600">ì·¨ì†Œ</button>
                <button onclick="checkAdminPw()" class="flex-1 py-3 bg-blue-600 rounded-xl font-bold text-white">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="modal-admin-panel" class="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold">ê´€ë¦¬ì ì„¤ì •</h3>
                <button onclick="closeAdminPanel()" class="text-gray-400"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
            </div>
            
            <div class="space-y-4">
                <!-- 1. ë½‘ê¸° ì œí•œ ì´ˆê¸°í™” -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 text-left">
                    <p class="text-sm font-bold text-gray-900 mb-1">ë½‘ê¸° ê¸°íšŒ ì´ˆê¸°í™”</p>
                    <p class="text-xs text-gray-500 mb-3">ëª¨ë“  ì‚¬ìš©ìê°€ ë‹¤ì‹œ 1íšŒ ë½‘ì„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>
                    <button onclick="adminResetLimits()" class="w-full py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-bold transition-colors">
                        ëª¨ë‘ ì´ˆê¸°í™” ì‹¤í–‰
                    </button>
                </div>

                <!-- 2. ë¬´í•œ ëª¨ë“œ í† ê¸€ -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 text-left flex items-center justify-between">
                    <div>
                        <p class="text-sm font-bold text-gray-900 mb-1">ë¬´í•œ ë½‘ê¸° ëª¨ë“œ</p>
                        <p class="text-xs text-gray-500">1íšŒ ì œí•œì„ ì¼ì‹œì ìœ¼ë¡œ í•´ì œí•©ë‹ˆë‹¤.</p>
                    </div>
                    <button id="btn-unlimited-toggle" onclick="adminToggleUnlimited()" class="w-12 h-7 bg-gray-300 rounded-full relative transition-colors">
                        <div class="w-5 h-5 bg-white rounded-full absolute top-1 left-1 transition-transform"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase ì´ˆê¸°í™” (ì‚¬ìš©ì ì œê³µ ì„¤ì •)
        const firebaseConfig = {
            apiKey: "AIzaSyB_GKGcBR-MGnhpRz_UbdRIy_iZN9rjNq4",
            authDomain: "random-enjoy.firebaseapp.com",
            projectId: "random-enjoy",
            storageBucket: "random-enjoy.firebasestorage.app",
            messagingSenderId: "337463244854",
            appId: "1:337463244854:web:9972e90fbacb6869a34097"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'random-enjoy-main'; 

        // ì „ì—­ ìƒíƒœ
        let globalState = {
            car: { timestamp: 0 },
            chore: { timestamp: 0 },
            trip: { timestamp: 0 },
            admin: { resetTimestamp: 0, unlimited: false }
        };
        let localTimestamps = { car: 0, chore: 0, trip: 0 };
        let isFirstLoad = true;

        let unsubscribe = null;

        // Firestore ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        const setupFirestoreListener = () => {
            const docRef = doc(db, 'games', 'random_enjoy_state');
            
            unsubscribe = onSnapshot(docRef, (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.data();
                    handleGameStateChange(data);
                } else {
                    setDoc(docRef, {
                        car: { timestamp: 0 },
                        chore: { timestamp: 0 },
                        trip: { timestamp: 0 },
                        admin: { resetTimestamp: Date.now(), unlimited: false }
                    }, { merge: true }).catch(e => console.error("Error creating init doc:", e));
                }
                isFirstLoad = false;
            }, (error) => {
                console.error("Snapshot error:", error);
                if(error.code === 'permission-denied') {
                    alert("âš ï¸ ê¶Œí•œ ì˜¤ë¥˜: Firebase Console ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”.");
                }
            });
        };

        const init = async () => {
            try {
                await signInAnonymously(auth);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        setupFirestoreListener();
                        updateButtonVisibility(); 
                    }
                });
            } catch (e) {
                console.error("Init error:", e);
            }
        };
        init();

        function handleGameStateChange(newData) {
            const oldState = globalState;
            globalState = newData;

            // 1. ìƒë‹¨ ì•Œë¦¼(Notifications) ê´€ë¦¬
            updateTopNotifications(newData);

            // 2. ë²„íŠ¼ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            updateButtonVisibility();

            // 3. ê²Œì„ë³„ ì—…ë°ì´íŠ¸ ê°ì§€ ë° í‘œì‹œ
            
            // Car
            if (newData.car) {
                if (newData.car.timestamp === 0) {
                    window.resetCarGame(); 
                } else if (!isFirstLoad && newData.car.timestamp > localTimestamps.car) {
                    localTimestamps.car = newData.car.timestamp;
                    playCarGameAnimation(newData.car);
                } else {
                    localTimestamps.car = newData.car.timestamp;
                    displayCarResult(newData.car);
                }
            }

            // Chore
            if (newData.chore) {
                if (newData.chore.timestamp === 0) {
                    window.resetChoreGame();
                } else if (!isFirstLoad && newData.chore.timestamp > localTimestamps.chore) {
                    localTimestamps.chore = newData.chore.timestamp;
                    playChoreGameAnimation(newData.chore);
                } else {
                    localTimestamps.chore = newData.chore.timestamp;
                    displayChoreResult(newData.chore);
                }
            }

            // Trip
            if (newData.trip) {
                if (newData.trip.timestamp === 0) {
                    window.resetTripGame();
                } else if (!isFirstLoad && newData.trip.timestamp > localTimestamps.trip) {
                    localTimestamps.trip = newData.trip.timestamp;
                    playTripGameAnimation(newData.trip);
                } else {
                    localTimestamps.trip = newData.trip.timestamp;
                    displayTripResult(newData.trip);
                }
            }
        }

        // ìƒë‹¨ ì•Œë¦¼ ê´€ë¦¬ ë¡œì§
        let resetBannerShownTime = 0; 

        function updateTopNotifications(data) {
            const container = document.getElementById('notification-container');
            const admin = data.admin;
            const anyGamePlayed = (data.car?.timestamp > 0) || (data.chore?.timestamp > 0) || (data.trip?.timestamp > 0);

            // 1. ë¬´í•œ ëª¨ë“œ ì•Œë¦¼ (Persistent)
            let unlimitedBanner = document.getElementById('noti-unlimited');
            if (admin.unlimited) {
                if (!unlimitedBanner) {
                    unlimitedBanner = createNotification('noti-unlimited', 'ğŸ”¥ ë¬´í•œ ë½‘ê¸° ëª¨ë“œ í™œì„±í™” ì¤‘!', 'bg-red-500', false);
                    container.appendChild(unlimitedBanner);
                }
            } else {
                if (unlimitedBanner) unlimitedBanner.remove();
            }

            // 2. ì´ˆê¸°í™” ì•Œë¦¼ (Dismissible + Auto-hide)
            // ë¡œì§: admin.resetTimestampê°€ ë³€ê²½ë˜ë©´ í‘œì‹œ. ëˆ„êµ°ê°€ ê²Œì„ì„ í•˜ë©´(anyGamePlayed) ì œê±°.
            let resetBanner = document.getElementById('noti-reset');
            
            // ë¦¬ì…‹ íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì²´í¬ (ë¡œì»¬ ë³€ìˆ˜ ì´ìš©)
            if (admin.resetTimestamp > resetBannerShownTime) {
                // ìƒˆ ë¦¬ì…‹ ë°œìƒ
                resetBannerShownTime = admin.resetTimestamp;
                // ê¸°ì¡´ ë°°ë„ˆ ì œê±° í›„ ì¬ìƒì„± (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼)
                if (resetBanner) resetBanner.remove();
                
                if (!anyGamePlayed) { // ê²Œì„ì´ ì§„í–‰ë˜ì§€ ì•Šì€ ìƒíƒœì—¬ì•¼ ëœ¸
                    resetBanner = createNotification('noti-reset', 'ğŸ“¢ ë½‘ê¸° ê¸°íšŒê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-blue-600', true);
                    container.appendChild(resetBanner);
                }
            }

            // ê²Œì„ì´ ì§„í–‰ë˜ë©´ ë¦¬ì…‹ ì•Œë¦¼ ì œê±°
            if (anyGamePlayed && resetBanner) {
                resetBanner.classList.remove('slide-down');
                resetBanner.classList.add('slide-up');
                setTimeout(() => { if(resetBanner) resetBanner.remove(); }, 300);
            }
            
            // ê´€ë¦¬ì íŒ¨ë„ UI ë™ê¸°í™”
            updateUnlimitedUI(admin.unlimited);
        }

        function createNotification(id, text, colorClass, dismissible) {
            const el = document.createElement('div');
            el.id = id;
            el.className = `${colorClass} text-white px-6 py-3 rounded-b-xl shadow-lg flex items-center gap-3 pointer-events-auto mb-2 slide-down font-bold text-sm`;
            
            const span = document.createElement('span');
            span.textContent = text;
            el.appendChild(span);

            if (dismissible) {
                const btn = document.createElement('button');
                btn.className = "ml-4 bg-white/20 hover:bg-white/40 rounded px-2 py-0.5 text-xs transition-colors";
                btn.textContent = "í™•ì¸";
                btn.onclick = () => {
                    el.classList.remove('slide-down');
                    el.classList.add('slide-up');
                    setTimeout(() => el.remove(), 300);
                };
                el.appendChild(btn);
            }
            return el;
        }

        window.updateButtonVisibility = () => {
            const isUnlimited = globalState.admin?.unlimited;
            // DBì— ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€ (ëˆ„êµ°ê°€ ë½‘ì•˜ìœ¼ë©´ ëª¨ë‘ì—ê²Œ ìˆ¨ê¹€)
            const carPlayed = globalState.car?.timestamp > 0;
            const chorePlayed = globalState.chore?.timestamp > 0;
            const tripPlayed = globalState.trip?.timestamp > 0;

            document.getElementById('btn-run-car').style.display = (!isUnlimited && carPlayed) ? 'none' : 'block';
            document.getElementById('btn-run-chore').style.display = (!isUnlimited && chorePlayed) ? 'none' : 'block';
            document.getElementById('btn-run-trip').style.display = (!isUnlimited && tripPlayed) ? 'none' : 'block';
        }

        // ==================== ê´€ë¦¬ì ê¸°ëŠ¥ ====================
        window.openAdminLogin = () => document.getElementById('modal-admin-login').classList.remove('hidden');
        window.closeAdminLogin = () => document.getElementById('modal-admin-login').classList.add('hidden');
        
        window.checkAdminPw = () => {
            const pw = document.getElementById('admin-pw').value;
            if (pw === '0920') {
                closeAdminLogin();
                document.getElementById('modal-admin-panel').classList.remove('hidden');
                document.getElementById('admin-pw').value = '';
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        };

        window.closeAdminPanel = () => document.getElementById('modal-admin-panel').classList.add('hidden');

        window.adminResetLimits = async () => {
            if (!confirm('ëª¨ë“  ì‚¬ìš©ìì˜ ë½‘ê¸° ê¸°íšŒë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const docRef = doc(db, 'games', 'random_enjoy_state'); 
                const currentAdminState = globalState.admin || { unlimited: false };
                
                // ë°ì´í„° ì´ˆê¸°í™”
                await setDoc(docRef, {
                    car: { timestamp: 0 },
                    chore: { timestamp: 0 },
                    trip: { timestamp: 0 },
                    admin: { 
                        ...currentAdminState, 
                        resetTimestamp: Date.now() 
                    }
                });
                // ì„±ê³µ ì‹œ ë³„ë„ alert ì—†ìŒ (ìƒë‹¨ íŒì—…ìœ¼ë¡œ ëŒ€ì²´ë¨)
                closeAdminPanel();
            } catch (e) {
                console.error("Reset failed:", e);
                alert("ì´ˆê¸°í™” ì‹¤íŒ¨: " + e.message);
            }
        };

        window.adminToggleUnlimited = async () => {
            try {
                const current = globalState.admin?.unlimited || false;
                const docRef = doc(db, 'games', 'random_enjoy_state');
                const currentAdminState = globalState.admin || { resetTimestamp: 0 };

                await setDoc(docRef, {
                    admin: {
                        ...currentAdminState,
                        unlimited: !current
                    }
                }, { merge: true });
                // ì„±ê³µ ì‹œ ë³„ë„ alert ì—†ìŒ (ìƒë‹¨ íŒì—…ìœ¼ë¡œ ëŒ€ì²´ë¨)
            } catch (e) {
                alert("ì„¤ì • ë³€ê²½ ì‹¤íŒ¨: " + e.message);
            }
        };

        function updateUnlimitedUI(isUnlimited) {
            const btn = document.getElementById('btn-unlimited-toggle');
            const dot = btn.querySelector('div');
            if (isUnlimited) {
                btn.classList.replace('bg-gray-300', 'bg-green-500');
                dot.classList.replace('left-1', 'translate-x-5'); 
                dot.style.transform = 'translateX(20px)'; 
            } else {
                btn.classList.replace('bg-green-500', 'bg-gray-300');
                dot.classList.replace('translate-x-5', 'left-1');
                dot.style.transform = 'translateX(0)';
            }
        }

        // ==================== ê²Œì„ ìš”ì²­ ====================
        function canPlay(gameType) {
            if (globalState.admin?.unlimited) return true; 
            if (globalState[gameType]?.timestamp > 0) {
                alert('ì´ë¯¸ ê²°ê³¼ê°€ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤! (ê´€ë¦¬ìê°€ ì´ˆê¸°í™”í•´ì•¼ ë‹¤ì‹œ ê°€ëŠ¥)');
                return false;
            }
            return true;
        }

        window.requestCarGame = async () => {
            if (!canPlay('car')) return;
            
            const driverMode = window.getDriverMode(); 
            const selectedDriver = window.getSelectedDriver();
            if (driverMode === 'manual' && !selectedDriver) {
                alert('ìš´ì „ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            let finalDriver = '';
            let passengers = [];
            if (driverMode === 'manual') {
                finalDriver = selectedDriver;
                passengers = MEMBERS.filter(m => m !== finalDriver);
            } else {
                const shuffled = [...MEMBERS].sort(() => Math.random() - 0.5);
                finalDriver = shuffled[0];
                passengers = shuffled.slice(1);
            }
            const shuffledPassengers = passengers.sort(() => Math.random() - 0.5);

            const docRef = doc(db, 'games', 'random_enjoy_state');
            await setDoc(docRef, {
                car: {
                    driver: finalDriver,
                    passengers: shuffledPassengers,
                    timestamp: Date.now()
                }
            }, { merge: true });
        };

        window.requestChoreGame = async () => {
            if (!canPlay('chore')) return;
            const shuffled = [...MEMBERS].sort(() => Math.random() - 0.5);
            const docRef = doc(db, 'games', 'random_enjoy_state');
            await setDoc(docRef, {
                chore: {
                    cleaner: shuffled[0],
                    dishwasher: shuffled[1],
                    timestamp: Date.now()
                }
            }, { merge: true });
        };

        window.requestTripGame = async () => {
            if (!canPlay('trip')) return;
            const step1 = REGION_POOL[Math.floor(Math.random() * REGION_POOL.length)];
            let step2 = null;
            if (TRIP_REGIONS_COMPLEX[step1]) {
                const subs = TRIP_REGIONS_COMPLEX[step1];
                step2 = subs[Math.floor(Math.random() * subs.length)];
            }
            const docRef = doc(db, 'games', 'random_enjoy_state');
            await setDoc(docRef, {
                trip: {
                    step1: step1,
                    step2: step2,
                    timestamp: Date.now()
                }
            }, { merge: true });
        };

        // ==================== ì• ë‹ˆë©”ì´ì…˜ ë° í‘œì‹œ ====================
        function playCarGameAnimation(data) {
            window.initAudio();
            const driverEl = document.getElementById('seat-driver');
            const pEls = ['seat-p1', 'seat-b1', 'seat-b2', 'seat-b3'].map(id => document.getElementById(id));
            window.animateShuffle(driverEl, MEMBERS, data.driver, 2000);
            pEls.forEach((el, i) => {
                window.animateShuffle(el, MEMBERS, data.passengers[i], 2000 + (i * 400));
            });
        }
        function displayCarResult(data) {
            if(!data.driver) return;
            document.getElementById('seat-driver').textContent = data.driver;
            document.getElementById('seat-driver').style.color = "#005ED2"; 
            const pIds = ['seat-p1', 'seat-b1', 'seat-b2', 'seat-b3'];
            pIds.forEach((id, i) => {
                const el = document.getElementById(id);
                el.textContent = data.passengers[i];
                el.style.color = "#005ED2";
            });
        }

        function playChoreGameAnimation(data) {
            window.initAudio();
            const cEl = document.getElementById('result-cleaning');
            const dEl = document.getElementById('result-dishes');
            window.animateShuffle(cEl, MEMBERS, data.cleaner, 1500);
            window.animateShuffle(dEl, MEMBERS, data.dishwasher, 2500);
        }
        function displayChoreResult(data) {
            if(!data.cleaner) return;
            const cEl = document.getElementById('result-cleaning');
            const dEl = document.getElementById('result-dishes');
            cEl.textContent = data.cleaner;
            dEl.textContent = data.dishwasher;
            cEl.style.color = "#2563eb";
            dEl.style.color = "#16a34a";
        }

        function playTripGameAnimation(data) {
            window.initAudio();
            window.resetTripUI();
            const el1 = document.getElementById('result-trip-step1');
            const el2 = document.getElementById('result-trip-step2');
            window.animateShuffleCallback(el1, REGION_POOL, data.step1, 2000, () => {
                if (data.step2) {
                    setTimeout(() => {
                        window.activateStep2UI();
                        const subRegions = TRIP_REGIONS_COMPLEX[data.step1];
                        window.animateShuffleCallback(el2, subRegions, data.step2, 2000, () => {
                            window.playWinSound();
                        });
                    }, 300);
                } else {
                    el2.textContent = "í•´ë‹¹ ì—†ìŒ";
                    window.playWinSound();
                }
            });
        }
        function displayTripResult(data) {
            if(!data.step1) return;
            window.resetTripUI();
            document.getElementById('result-trip-step1').textContent = data.step1;
            document.getElementById('result-trip-step1').style.color = "#9333ea";
            if (data.step2) {
                window.activateStep2UI();
                const el2 = document.getElementById('result-trip-step2');
                el2.textContent = data.step2;
                el2.style.color = "#9333ea";
            } else {
                document.getElementById('result-trip-step2').textContent = "í•´ë‹¹ ì—†ìŒ";
            }
        }
    </script>

    <!-- ê¸°ì¡´ ë¡œì§ ìŠ¤í¬ë¦½íŠ¸ (UI Helper ë° ì‚¬ìš´ë“œ) -->
    <script>
        const MEMBERS = ['ì „ì‹œê¸°', 'ì˜¤ìŠ¤í‹´', 'ì§€ë…¸', 'í™ë°•ì‚¬', 'ì„±ì›ì œ'];
        const TRIP_REGIONS_SIMPLE = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'];
        const TRIP_REGIONS_COMPLEX = {
            'ê²½ê¸°ë„': ['ìˆ˜ì›ì‹œ', 'ê³ ì–‘ì‹œ', 'ìš©ì¸ì‹œ', 'ì„±ë‚¨ì‹œ', 'ë¶€ì²œì‹œ', 'í™”ì„±ì‹œ', 'ì•ˆì‚°ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ì•ˆì–‘ì‹œ', 'í‰íƒì‹œ', 'ì‹œí¥ì‹œ', 'íŒŒì£¼ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ê¹€í¬ì‹œ', 'ê´‘ì£¼ì‹œ', 'ê´‘ëª…ì‹œ', 'êµ°í¬ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì–‘ì£¼ì‹œ', 'ì´ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ì•ˆì„±ì‹œ', 'í¬ì²œì‹œ', 'ì˜ì™•ì‹œ', 'ì–‘í‰êµ°', 'ì—¬ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ê°€í‰êµ°', 'ê³¼ì²œì‹œ', 'ì—°ì²œêµ°'],
            'ê°•ì›íŠ¹ë³„ìì¹˜ë„': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
            'ì¶©ì²­ë¶ë„': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
            'ì¶©ì²­ë‚¨ë„': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
            'ì „ë¶íŠ¹ë³„ìì¹˜ë„': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
            'ì „ë¼ë‚¨ë„': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
            'ê²½ìƒë¶ë„': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
            'ê²½ìƒë‚¨ë„': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
            'ì œì£¼íŠ¹ë³„ìì¹˜ë„': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
        };
        const REGION_POOL = [...TRIP_REGIONS_SIMPLE, ...Object.keys(TRIP_REGIONS_COMPLEX)];

        // UI Helpers
        function switchScreen(screenId) {
            document.querySelectorAll('[id^="screen-"]').forEach(el => {
                el.classList.add('hidden-screen');
                el.classList.remove('flex', 'fade-in');
            });
            const target = document.getElementById(screenId);
            target.classList.remove('hidden-screen');
            target.classList.add('flex', 'fade-in');
        }

        // ì°¨ëŸ‰ ê²Œì„ UI Helper
        let driverMode = 'random';
        let selectedDriver = null;
        
        window.getDriverMode = () => driverMode;
        window.getSelectedDriver = () => selectedDriver;

        window.resetCarGame = () => {
            window.setDriverMode('random');
            clearCarResults();
        }
        window.setDriverMode = (mode) => {
            driverMode = mode;
            selectedDriver = null;
            const btnRandom = document.getElementById('mode-random');
            const btnManual = document.getElementById('mode-manual');
            const selector = document.getElementById('manual-selector');
            const driverSeat = document.getElementById('seat-driver');

            if (mode === 'random') {
                btnRandom.classList.replace('text-gray-400', 'bg-white');
                btnRandom.classList.add('text-black', 'shadow-sm');
                btnManual.classList.remove('bg-white', 'text-black', 'shadow-sm');
                btnManual.classList.add('text-gray-400');
                selector.classList.add('hidden');
                selector.classList.remove('flex');
                
                if(driverSeat.textContent === 'ì„ íƒí•„ìš”') {
                    driverSeat.textContent = '?';
                    driverSeat.style.color = '';
                }
            } else {
                btnManual.classList.replace('text-gray-400', 'bg-white');
                btnManual.classList.add('text-black', 'shadow-sm');
                btnRandom.classList.remove('bg-white', 'text-black', 'shadow-sm');
                btnRandom.classList.add('text-gray-400');
                selector.classList.remove('hidden');
                selector.classList.add('flex');
                renderManualSelector();
                
                if(driverSeat.textContent === '?' || driverSeat.textContent === '...') {
                    driverSeat.textContent = 'ì„ íƒí•„ìš”';
                    driverSeat.style.color = 'gray';
                }
            }
        }
        function renderManualSelector() {
            const container = document.getElementById('manual-selector');
            container.innerHTML = '<p class="w-full text-xs text-gray-400 mb-1">ìš´ì „í•  ì‚¬ëŒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”:</p>';
            MEMBERS.forEach(member => {
                const btn = document.createElement('button');
                btn.className = `px-3 py-1 text-sm rounded-full border transition-all ${selectedDriver === member ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-600 border-gray-200 hover:border-blue-300'}`;
                btn.textContent = member;
                btn.onclick = () => {
                    selectedDriver = member;
                    document.getElementById('seat-driver').textContent = member;
                    document.getElementById('seat-driver').style.color = '#005ED2';
                    renderManualSelector();
                };
                container.appendChild(btn);
            });
        }
        function clearCarResults() {
            const seats = ['seat-driver', 'seat-p1', 'seat-b1', 'seat-b2', 'seat-b3'];
            seats.forEach(id => {
                const el = document.getElementById(id);
                el.textContent = '?';
                el.style.color = ''; 
                el.classList.remove('shuffling', 'text-red-500', 'text-blue-600'); 
                el.classList.add('text-black', 'text-gray-800');
            });
            if(driverMode === 'manual' && !selectedDriver) {
                document.getElementById('seat-driver').textContent = 'ì„ íƒí•„ìš”';
                document.getElementById('seat-driver').style.color = 'gray';
            }
        }

        // ì²­ì†Œ ê²Œì„ UI Helper
        window.resetChoreGame = () => {
            document.getElementById('result-cleaning').textContent = '?';
            document.getElementById('result-dishes').textContent = '?';
            document.getElementById('result-cleaning').style.color = '';
            document.getElementById('result-dishes').style.color = '';
        }

        // ì—¬í–‰ ê²Œì„ UI Helper
        window.resetTripGame = () => {
            resetTripUI();
        }
        window.resetTripUI = () => {
            document.getElementById('result-trip-step1').textContent = '?';
            document.getElementById('result-trip-step2').textContent = '-';
            
            const box2 = document.getElementById('box-trip-step2');
            const text2 = document.getElementById('result-trip-step2');
            const badge2 = document.getElementById('badge-step2');
            const label2 = document.getElementById('label-step2');
            
            box2.classList.replace('border-purple-100', 'border-gray-100');
            box2.classList.replace('bg-purple-50', 'bg-white');
            text2.classList.replace('text-gray-900', 'text-gray-300');
            badge2.classList.replace('bg-purple-200', 'bg-gray-100');
            badge2.classList.replace('text-purple-600', 'text-gray-400');
            label2.classList.replace('text-purple-500', 'text-gray-400');
            
            document.getElementById('result-trip-step1').classList.remove('shuffling', 'text-purple-600');
            text2.classList.remove('shuffling', 'text-purple-600');
            document.getElementById('result-trip-step1').style.color = '';
            text2.style.color = '';
        }
        window.activateStep2UI = () => {
            const box2 = document.getElementById('box-trip-step2');
            const text2 = document.getElementById('result-trip-step2');
            const badge2 = document.getElementById('badge-step2');
            const label2 = document.getElementById('label-step2');
            
            box2.classList.replace('border-gray-100', 'border-purple-100');
            box2.classList.replace('bg-white', 'bg-purple-50');
            text2.classList.replace('text-gray-300', 'text-gray-900');
            badge2.classList.replace('bg-gray-100', 'bg-purple-200');
            badge2.classList.replace('text-gray-400', 'text-purple-600');
            label2.classList.replace('text-gray-400', 'text-purple-500');
        }

        // ì‚¬ìš´ë“œ
        let audioCtx = null;
        window.initAudio = () => {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }
        window.playWinSound = () => {
            window.initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(659, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(3.0, audioCtx.currentTime); 
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        }
        window.playTickSound = () => {
            window.initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(1.0, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.05);
        }

        // ê³µí†µ ì• ë‹ˆë©”ì´ì…˜
        window.animateShuffle = (element, candidates, finalValue, duration) => {
            window.animateShuffleCallback(element, candidates, finalValue, duration, null);
        }
        window.animateShuffleCallback = (element, candidates, finalValue, duration, callback) => {
            element.classList.add('shuffling');
            let tickCount = 0;
            const interval = setInterval(() => {
                const randomVal = candidates[Math.floor(Math.random() * candidates.length)];
                element.textContent = randomVal;
                tickCount++;
                if(tickCount % 3 === 0) window.playTickSound(); 
            }, 80); 

            setTimeout(() => {
                clearInterval(interval);
                element.textContent = finalValue;
                element.classList.remove('shuffling');
                
                if (!callback) {
                    window.playWinSound();
                    element.style.transform = "scale(1.2)";
                    if(element.id.includes('cleaning')) element.style.color = "#2563eb"; 
                    else if(element.id.includes('dishes')) element.style.color = "#16a34a"; 
                    else if(element.id.includes('seat')) element.style.color = "#005ED2"; 
                    else if(element.id.includes('trip')) element.style.color = "#9333ea";
                    setTimeout(() => { element.style.transform = "scale(1)"; }, 300);
                } else {
                    callback();
                    if(element.id.includes('trip')) {
                        element.style.transform = "scale(1.1)";
                        element.style.color = "#9333ea";
                        setTimeout(() => { element.style.transform = "scale(1)"; }, 300);
                    }
                }
            }, duration);
        }
    </script>
</body>
</html>